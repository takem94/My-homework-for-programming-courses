!function i(a,u,s){function c(e,t){if(!u[e]){if(!a[e]){var r="function"==typeof require&&require;if(!t&&r)return r(e,!0);if(l)return l(e,!0);var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}var o=u[e]={exports:{}};a[e][0].call(o.exports,function(t){return c(a[e][1][t]||t)},o,o.exports,i,a,u,s)}return u[e].exports}for(var l="function"==typeof require&&require,t=0;t<s.length;t++)c(s[t]);return c}({1:[function(t,e,r){function s(t,e,r,n,o,i,a){try{var u=t[i](a),s=u.value}catch(t){return void r(t)}u.done?e(s):Promise.resolve(s).then(n,o)}e.exports=function(u){return function(){var t=this,a=arguments;return new Promise(function(e,r){var n=u.apply(t,a);function o(t){s(n,e,r,o,i,"next",t)}function i(t){s(n,e,r,o,i,"throw",t)}o(void 0)})}}},{}],2:[function(t,e,r){e.exports=function(t){return t&&t.__esModule?t:{default:t}}},{}],3:[function(t,e,r){var n=function(){return this||"object"==typeof self&&self}()||Function("return this")(),o=n.regeneratorRuntime&&0<=Object.getOwnPropertyNames(n).indexOf("regeneratorRuntime"),i=o&&n.regeneratorRuntime;if(n.regeneratorRuntime=void 0,e.exports=t("./runtime"),o)n.regeneratorRuntime=i;else try{delete n.regeneratorRuntime}catch(t){n.regeneratorRuntime=void 0}},{"./runtime":4}],4:[function(t,H,e){!function(t){"use strict";var s,e=Object.prototype,c=e.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},o=r.iterator||"@@iterator",n=r.asyncIterator||"@@asyncIterator",i=r.toStringTag||"@@toStringTag",a="object"==typeof H,u=t.regeneratorRuntime;if(u)a&&(H.exports=u);else{(u=t.regeneratorRuntime=a?H.exports:{}).wrap=w;var f="suspendedStart",d="suspendedYield",h="executing",p="completed",m={},l={};l[o]=function(){return this};var g=Object.getPrototypeOf,v=g&&g(g(O([])));v&&v!==e&&c.call(v,o)&&(l=v);var y=x.prototype=_.prototype=Object.create(l);L.prototype=y.constructor=x,x.constructor=L,x[i]=L.displayName="GeneratorFunction",u.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===L||"GeneratorFunction"===(e.displayName||e.name))},u.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,x):(t.__proto__=x,i in t||(t[i]="GeneratorFunction")),t.prototype=Object.create(y),t},u.awrap=function(t){return{__await:t}},E(M.prototype),M.prototype[n]=function(){return this},u.AsyncIterator=M,u.async=function(t,e,r,n){var o=new M(w(t,e,r,n));return u.isGeneratorFunction(e)?o:o.next().then(function(t){return t.done?t.value:o.next()})},E(y),y[i]="Generator",y[o]=function(){return this},y.toString=function(){return"[object Generator]"},u.keys=function(r){var n=[];for(var t in r)n.push(t);return n.reverse(),function t(){for(;n.length;){var e=n.pop();if(e in r)return t.value=e,t.done=!1,t}return t.done=!0,t}},u.values=O,R.prototype={constructor:R,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=s,this.done=!1,this.delegate=null,this.method="next",this.arg=s,this.tryEntries.forEach(V),!t)for(var e in this)"t"===e.charAt(0)&&c.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=s)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(r){if(this.done)throw r;var n=this;function t(t,e){return i.type="throw",i.arg=r,n.next=t,e&&(n.method="next",n.arg=s),!!e}for(var e=this.tryEntries.length-1;0<=e;--e){var o=this.tryEntries[e],i=o.completion;if("root"===o.tryLoc)return t("end");if(o.tryLoc<=this.prev){var a=c.call(o,"catchLoc"),u=c.call(o,"finallyLoc");if(a&&u){if(this.prev<o.catchLoc)return t(o.catchLoc,!0);if(this.prev<o.finallyLoc)return t(o.finallyLoc)}else if(a){if(this.prev<o.catchLoc)return t(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return t(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;0<=r;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&c.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=t,i.arg=e,o?(this.method="next",this.next=o.finallyLoc,m):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),m},finish:function(t){for(var e=this.tryEntries.length-1;0<=e;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),V(r),m}},catch:function(t){for(var e=this.tryEntries.length-1;0<=e;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;V(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:O(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=s),m}}}function w(t,e,r,n){var i,a,u,s,o=e&&e.prototype instanceof _?e:_,c=Object.create(o.prototype),l=new R(n||[]);return c._invoke=(i=t,a=r,u=l,s=f,function(t,e){if(s===h)throw new Error("Generator is already running");if(s===p){if("throw"===t)throw e;return j()}for(u.method=t,u.arg=e;;){var r=u.delegate;if(r){var n=P(r,u);if(n){if(n===m)continue;return n}}if("next"===u.method)u.sent=u._sent=u.arg;else if("throw"===u.method){if(s===f)throw s=p,u.arg;u.dispatchException(u.arg)}else"return"===u.method&&u.abrupt("return",u.arg);s=h;var o=b(i,a,u);if("normal"===o.type){if(s=u.done?p:d,o.arg===m)continue;return{value:o.arg,done:u.done}}"throw"===o.type&&(s=p,u.method="throw",u.arg=o.arg)}}),c}function b(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}function _(){}function L(){}function x(){}function E(t){["next","throw","return"].forEach(function(e){t[e]=function(t){return this._invoke(e,t)}})}function M(s){var e;this._invoke=function(r,n){function t(){return new Promise(function(t,e){!function e(t,r,n,o){var i=b(s[t],s,r);if("throw"!==i.type){var a=i.arg,u=a.value;return u&&"object"==typeof u&&c.call(u,"__await")?Promise.resolve(u.__await).then(function(t){e("next",t,n,o)},function(t){e("throw",t,n,o)}):Promise.resolve(u).then(function(t){a.value=t,n(a)},function(t){return e("throw",t,n,o)})}o(i.arg)}(r,n,t,e)})}return e=e?e.then(t,t):t()}}function P(t,e){var r=t.iterator[e.method];if(r===s){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=s,P(t,e),"throw"===e.method))return m;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return m}var n=b(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,m;var o=n.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=s),e.delegate=null,m):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,m)}function T(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function V(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function R(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(T,this),this.reset(!0)}function O(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,n=function t(){for(;++r<e.length;)if(c.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=s,t.done=!0,t};return n.next=n}}return{next:j}}function j(){return{value:s,done:!0}}}(function(){return this||"object"==typeof self&&self}()||Function("return this")())},{}],5:[function(t,e,r){e.exports=t("regenerator-runtime")},{"regenerator-runtime":3}],6:[function(c,t,e){(function(t){"use strict";var e=c("@babel/runtime/helpers/interopRequireDefault"),r=e(c("@babel/runtime/regenerator")),n=e(c("@babel/runtime/helpers/asyncToGenerator")),a=c("./modules/router"),o=c("./modules/model"),i=c("./modules/view");a.Router.handle("friends"),t.Handlebars.registerHelper("formatTime",function(t){var e=parseInt(t/60),r=t-60*e;return(e=1===e.toString().length?"0"+e:e)+":"+(r=1===r.toString().length?"0"+r:r)}),t.Handlebars.registerHelper("formatDate",function(t){return new Date(1e3*t).toLocaleString()});var u=document.getElementById("header");function s(){return(s=(0,n.default)(r.default.mark(function t(){var e;return r.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,o.Model.login(6899585,8206);case 3:return t.next=5,o.Model.getUser();case 5:e=t.sent,u.innerHTML=i.View.render("header",e[0]),document.addEventListener("click",function(t){if(t.target.dataset.vkMethod&&a.Router.handle(t.target.dataset.vkMethod),t.target.dataset.idPhoto&&0<t.target.dataset.count){var e=t.target.nextElementSibling,r=t.target.dataset.idPhoto;"false"===t.target.dataset.statusBtn?(t.target.dataset.statusComments||(t.target.dataset.statusComments="true",a.Router.handle("comments",{id:r,elem:e})),t.target.dataset.statusBtn="true",t.target.innerText="Скрыть комментарии",e.classList.remove("photos__list_hidden")):(t.target.dataset.statusBtn="false",t.target.innerText="Показать комментарии",e.classList.add("photos__list_hidden"))}if(t.target.dataset.sortBy&&!t.target.classList.contains("sort__button_active")){var n=t.target.dataset.sortBy;a.Router.handle("sort",{by:n});var o=document.querySelectorAll(".sort__button_active"),i=document.querySelector('button[data-sort-by="'+n+'"]');o.forEach(function(t){t.classList.remove("sort__button_active")}),i.classList.add("sort__button_active")}}),t.next=14;break;case 10:t.prev=10,t.t0=t.catch(0),console.error(t.t0),window.alert("Ошибка: "+t.t0.message);case 14:case"end":return t.stop()}},t,null,[[0,10]])}))).apply(this,arguments)}window.addEventListener("DOMContentLoaded",function(){return s.apply(this,arguments)})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./modules/model":8,"./modules/router":9,"./modules/view":10,"@babel/runtime/helpers/asyncToGenerator":1,"@babel/runtime/helpers/interopRequireDefault":2,"@babel/runtime/regenerator":5}],7:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Controller=void 0;var n=t("./view"),o=t("./model"),i={lastPhotos:null,friendsRoute:function(){return n.View.results.innerHTML=n.View.render("loader"),o.Model.getFriends().then(function(t){n.View.results.innerHTML=n.View.render("friends",t)})},newsRoute:function(){return n.View.results.innerHTML=n.View.render("loader"),o.Model.getNews().then(function(t){n.View.results.innerHTML=n.View.render("news",{list:t.items})})},groupsRoute:function(){return n.View.results.innerHTML=n.View.render("loader"),o.Model.getGroups().then(function(t){n.View.results.innerHTML=n.View.render("groups",t)})},photosRoute:function(){return n.View.results.innerHTML=n.View.render("loader"),o.Model.getAlbums().then(function(t){var r=[];t.items.forEach(function(e){r.push(function(){return o.Model.getPhotos(e.id).then(function(t){e.items=t.items})})});var e=Promise.resolve();return r.forEach(function(t){e=e.then(t)}),e.then(function(){return t})}).then(function(t){for(var e=t.items.length-1;0<=e;--e)0===t.items[e].items.length&&t.items.splice(e,1);this.lastPhotos=t,n.View.results.innerHTML=n.View.render("photos",t)}.bind(this))},commentsRoute:function(e){return o.Model.getComments(e.id).then(function(t){e.elem.innerHTML=n.View.render("comments",t)})},sortRoute:function(t){var e=o.Model.sortPhotos(this.lastPhotos,t.by);n.View.results.innerHTML=n.View.render("photos",e)}};r.Controller=i},{"./model":8,"./view":10}],8:[function(t,e,r){(function(o){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Model=void 0;var t={login:function(t,n){return new Promise(function(e,r){o.VK.init({apiId:t}),o.VK.Auth.login(function(t){t.session?e(t):r(new Error("Не удалось авторизоваться"))},n)})},callApi:function(t,n){return n.v="5.92",new Promise(function(e,r){o.VK.api(t,n,function(t){t.error?r(new Error(t.error.error_msg)):e(t.response)})})},getUser:function(){return this.callApi("users.get",{})},getFriends:function(){return this.callApi("friends.get",{fields:"photo_100"})},getNews:function(){return this.callApi("newsfeed.get",{filters:"post",count:20})},getGroups:function(){return this.callApi("groups.get",{extended:1})},getAlbums:function(){return this.callApi("photos.getAlbums",{count:6,need_system:1})},getPhotos:function(t){return this.callApi("photos.get",{extended:1,rev:1,album_id:t,count:6}).then(function(e){return new Promise(function(t){e.items.forEach(function(t){t.photo_300=t.sizes[3].url}),setTimeout(function(){t(e)},350)})})},getComments:function(t){return this.callApi("photos.getComments",{sort:"asc",photo_id:t,extended:1,fields:"photo_50"}).then(function(r){return r.items.forEach(function(t){for(var e=0;e<r.profiles.length;++e)if(parseInt(t.from_id)===parseInt(r.profiles[e].id)){t.photo_50=r.profiles[e].photo_50,t.full_name=r.profiles[e].first_name+" "+r.profiles[e].last_name;break}}),r})},sortPhotos:function(t,o){return t.items.forEach(function(t){t.items.sort(function(t,e){var r=[t[o],e[o]];if(t=r[0],e=r[1],"date"!==o){var n=[t.count,e.count];t=n[0],e=n[1]}return e<t?-1:t<e?1:0})}),t}};r.Model=t}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],9:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Router=void 0;var n=t("./controller"),o={handle:function(t,e){var r=t+"Route";n.Controller[r](e)}};r.Router=o},{"./controller":7}],10:[function(t,e,r){(function(n){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.View=void 0;var t={results:document.getElementById("results"),render:function(t,e){t+="Template";var r=document.getElementById(t).innerHTML;return n.Handlebars.compile(r)(e)}};r.View=t}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[6]);