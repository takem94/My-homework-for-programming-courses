(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
(function (global){
'use strict';

function load() {
  var modalTemplate = document.getElementById('modalTemplate').innerHTML;
  var avatarTemplate = document.getElementById('avatarTemplate').innerHTML;
  var authTemplate = document.getElementById('authenticationTemplate').innerHTML;
  var usersTemplate = document.getElementById('usersTemplate').innerHTML;
  var messageTemplate = document.getElementById('messageTemplate').innerHTML;
  var modalRender = global.Handlebars.compile(modalTemplate);
  var avatarRender = global.Handlebars.compile(avatarTemplate);
  var authRender = global.Handlebars.compile(authTemplate);
  var usersRender = global.Handlebars.compile(usersTemplate);
  var messageRender = global.Handlebars.compile(messageTemplate);

  function showAuth() {
    document.body.innerHTML += modalRender({
      windowName: 'Авторизация',
      windowBody: authRender({})
    });
  }

  function showAvatarChanger() {
    document.body.innerHTML += modalRender({
      windowName: 'Смена аватара',
      windowBody: avatarRender({})
    });
  }

  function removeModal() {
    var modal = document.getElementById('modal');

    if (modal) {
      modal.outerHTML = '';
    }
  }

  function changeChatName(firstName, lastName) {
    var nameElem = document.getElementById('chatUserName');
    nameElem.innerText = "".concat(firstName, " ").concat(lastName);
  }

  function changeAvatar(src) {
    var avatar = document.querySelector('.user-profile__avatar img');
    avatar.src = src;
  }

  function changePreview(src) {
    var avatar = document.querySelector('.drag-n-drop__preview');
    avatar.src = src;
  }

  function changeAvatarMessage(userId, src) {
    var allMessages = document.querySelectorAll("li[data-user-id=\"".concat(userId, "\"] img"));
    allMessages.forEach(function (elem) {
      elem.setAttribute('src', src);
    });
  }

  function listScrollToBottom(elem) {
    elem.scrollTop = elem.scrollHeight;
  }

  function renderUserListPanel(data) {
    var chatPanel = document.getElementById('chatPanel');
    chatPanel.innerHTML = usersRender(data);
  }

  function showChatArea() {
    var chatArea = document.getElementById('chat');
    chatArea.style.opacity = '1';
    chatArea.offsetHeight;
  }

  function hideChatArea() {
    var chatArea = document.getElementById('chat');
    chatArea.style.opacity = '0';
    chatArea.offsetHeight;
  }

  function parseTime(time) {
    time = new Date(time);
    time = (time.getHours() < 10 ? '0' + time.getHours() : time.getHours()) + ':' + (time.getMinutes() < 10 ? '0' + time.getMinutes() : time.getMinutes()) + ':' + (time.getSeconds() < 10 ? '0' + time.getSeconds() : time.getSeconds());
    return time;
  }

  function removeAnimation(messageId, time) {
    var elem = document.querySelector("li[data-message-id=\"".concat(messageId, "\"]"));
    setTimeout(function () {
      elem.classList.remove('fade-in');
    }, time);
  }

  var fileReader;
  var result;
  var dragAndDrop;
  var dragTimeout;
  var dragZoneTimeout;
  var eventsObject = {
    onUploadChange: function onUploadChange(e) {
      var file = e.target.files[0];
      fileReader = new global.FileReader();
      fileReader.addEventListener('loadend', this.onEnd.bind(this));

      if (file && file.type === 'image/jpeg') {
        fileReader.readAsDataURL(file);
      } else {
        window.alert('Пожалуйста, выберите файл с расширением jpeg.');
      }

      e.target.removeEventListener('change', this.onUploadChange);
    },
    onEnd: function onEnd() {
      result = {
        type: 'user-avatar',
        data: fileReader.result
      };
      changePreview(fileReader.result);
      fileReader.removeEventListener('loadend', this.onEnd);
    },
    onDrag: function onDrag(e) {
      e.preventDefault();
      console.log('Class: eventsObject, Line: 116 ', e);
    },
    preventDefaults: function preventDefaults(e) {
      e.preventDefault();
      e.stopPropagation();
    },
    highlight: function highlight() {
      dragAndDrop.classList.add('highlight');
    },
    unhighlight: function unhighlight() {
      dragAndDrop.classList.remove('highlight');
    },
    onEnter: function onEnter() {
      if (!dragAndDrop) {
        return;
      }

      dragAndDrop.classList.add('prepare');
    },
    onEndDrag: function onEndDrag() {
      dragAndDrop.classList.remove('prepare');
    },
    onDragOver: function onDragOver() {
      if (!dragAndDrop) {
        return;
      }

      if (dragTimeout !== undefined) {
        window.clearTimeout(dragTimeout);
      }

      dragTimeout = window.setTimeout(function () {
        eventsObject.onEndDrag();
      }, 200);
    },
    onDragEnterZone: function onDragEnterZone() {
      dragAndDrop.classList.add('highlight');
    },
    onDragOverZone: function onDragOverZone() {
      if (!dragAndDrop) {
        return;
      }

      eventsObject.onDragOver();

      if (dragZoneTimeout !== undefined) {
        window.clearTimeout(dragZoneTimeout);
      }

      dragZoneTimeout = window.setTimeout(function () {
        dragAndDrop.classList.remove('highlight');
      }, 200);
    },
    onDropZone: function onDropZone(e) {
      var uploader = document.getElementById('imgUpload');
      var dropedFiles = e.dataTransfer.files;

      if (uploader) {
        uploader.files = dropedFiles;
      } else {
        return;
      }

      uploader.addEventListener('change', eventsObject.onUploadChange.bind(eventsObject));
      uploader.dispatchEvent(new global.Event('change'));
    },
    doDnDListeners: function doDnDListeners(dragAndDrop, what) {
      var whatToDo;

      if (what === 'unset') {
        whatToDo = 'removeEventListener';
      } else if (what === 'set') {
        whatToDo = 'addEventListener';
      } else {
        return;
      }

      ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(function (eventName) {
        dragAndDrop[whatToDo](eventName, eventsObject.preventDefaults);
      });
      dragAndDrop[whatToDo]('dragenter', eventsObject.onDragEnterZone, false);
      dragAndDrop[whatToDo]('dragover', eventsObject.onDragOverZone, false);
      dragAndDrop[whatToDo]('drop', eventsObject.onDropZone, false);
    }
  };
  document.addEventListener('dragenter', eventsObject.onEnter, false);
  document.addEventListener('dragover', eventsObject.onDragOver, false);
  document.addEventListener('click', function (e) {
    if (e.target.parentElement.classList.contains('user-profile__avatar')) {
      showAvatarChanger();
      dragAndDrop = document.querySelector('.drag-n-drop__zone');
      eventsObject.doDnDListeners(dragAndDrop, 'set');
    }

    if (e.target.classList.contains('drag-n-drop__add')) {
      var uploader = document.getElementById('imgUpload');
      dragAndDrop = document.querySelector('.drag-n-drop__zone');
      uploader.addEventListener('change', eventsObject.onUploadChange.bind(eventsObject));
      uploader.dispatchEvent(new window.MouseEvent('click'));
    }

    if (e.target.getAttribute('id') === 'saveBtnAvatar') {
      if (result) {
        ws.send(JSON.stringify(result));
        eventsObject.doDnDListeners(dragAndDrop, 'unset');
        removeModal();
      } else {
        window.alert('Фото не выбрано.');
      }
    }

    if (e.target.getAttribute('id') === 'cancelBtnAvatar') {
      eventsObject.doDnDListeners(dragAndDrop, 'unset');
      removeModal();
    }
  });
  document.addEventListener('submit', function (e) {
    if (e.target.getAttribute('id') === 'auth') {
      e.preventDefault();
      var fnameInput = document.getElementById('fname');
      var lnameInput = document.getElementById('lname');

      if (fnameInput.value.length > 2 && lnameInput.value.length > 2) {
        var userData = {
          fullName: "".concat(fnameInput.value, " ").concat(lnameInput.value),
          firstName: fnameInput.value,
          lastName: lnameInput.value,
          type: 'user-join'
        };
        ws.send(JSON.stringify(userData));
      }
    }

    if (e.target.getAttribute('id') === 'messageForm') {
      e.preventDefault();
      var messageInput = document.getElementById('messageInput');

      if (messageInput.value.length > 0) {
        var dataToSend = {
          message: messageInput.value,
          fullName: userInfo.fullName,
          type: 'user-message'
        };
        ws.send(JSON.stringify(dataToSend));
        messageInput.value = '';
      }
    }
  }); //
  // WebSocket
  //

  var ws;
  var userInfo = {};
  var usersData = [];

  var webSocketConnect = function webSocketConnect(location) {
    window.WebSocket = window.WebSocket || window.MozWebSocket;
    ws = new window.WebSocket(location);

    ws.onopen = function () {
      showAuth();
    };

    ws.onmessage = function (message) {
      var data = JSON.parse(message.data);
      var user = data.userId ? usersData.find(function (elem) {
        return elem.userId === data.userId;
      }) || {} : {};

      if (data.type === 'user-join') {
        changeChatName(data.firstName, data.lastName);
        removeModal();
        showChatArea();
        userInfo = data;
      }

      if (data.type === 'users-list') {
        var _loop = function _loop(i, _elem) {
          _elem = data.users[i];
          var findUser = usersData.find(function (userData) {
            return userData.userId === _elem.id;
          });

          if (!findUser) {
            usersData.push(_elem);
          }

          elem = _elem;
        };

        for (var i = 0, elem; i < data.count; ++i) {
          _loop(i, elem);
        }

        renderUserListPanel({
          users: usersData,
          count: usersData.length
        });
      }

      if (data.type === 'user-add') {
        usersData.push(data);
        renderUserListPanel({
          users: usersData,
          count: usersData.length
        });
      }

      if (data.type === 'user-message') {
        var messageList = document.getElementById('messageList');
        data.time = parseTime(data.time);
        data.avatar = user.avatar || './img/avatar.png';
        messageList.innerHTML += messageRender(data);
        removeAnimation(data.messageId, 1070);
        listScrollToBottom(messageList);
      }

      if (data.type === 'user-avatar') {
        if (data.userId === userInfo.userId) {
          changeAvatar(data.data);
        }

        user['avatar'] = data.data;
        changeAvatarMessage(data.userId, data.data);
      }

      if (data.type === 'user-remove') {
        var indexDel = usersData.findIndex(function (elem) {
          return elem.userId === data.userId;
        });

        if (indexDel !== undefined) {
          usersData.splice(indexDel, 1);
        }

        renderUserListPanel({
          users: usersData,
          count: usersData.length
        });
      }
    };

    ws.onclose = function () {
      userInfo = {};
      usersData = [];
      hideChatArea();
      removeModal(); // Try reconnect every 2.5 sec.

      setTimeout(function () {
        webSocketConnect(location);
      }, 2500);
    };
  };

  webSocketConnect('ws://192.168.0.100:8085');
}

(function () {
  window.addEventListener('DOMContentLoaded', load);
})();

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvanMvYXBwLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOztBQ0FBOztBQUVBLFNBQVMsSUFBVCxHQUFpQjtBQUNmLE1BQU0sYUFBYSxHQUFHLFFBQVEsQ0FBQyxjQUFULENBQXdCLGVBQXhCLEVBQXlDLFNBQS9EO0FBQ0EsTUFBTSxjQUFjLEdBQUcsUUFBUSxDQUFDLGNBQVQsQ0FBd0IsZ0JBQXhCLEVBQTBDLFNBQWpFO0FBQ0EsTUFBTSxZQUFZLEdBQUcsUUFBUSxDQUFDLGNBQVQsQ0FBd0Isd0JBQXhCLEVBQWtELFNBQXZFO0FBQ0EsTUFBTSxhQUFhLEdBQUcsUUFBUSxDQUFDLGNBQVQsQ0FBd0IsZUFBeEIsRUFBeUMsU0FBL0Q7QUFDQSxNQUFNLGVBQWUsR0FBRyxRQUFRLENBQUMsY0FBVCxDQUF3QixpQkFBeEIsRUFBMkMsU0FBbkU7QUFFQSxNQUFJLFdBQVcsR0FBRyxNQUFNLENBQUMsVUFBUCxDQUFrQixPQUFsQixDQUEwQixhQUExQixDQUFsQjtBQUNBLE1BQUksWUFBWSxHQUFHLE1BQU0sQ0FBQyxVQUFQLENBQWtCLE9BQWxCLENBQTBCLGNBQTFCLENBQW5CO0FBQ0EsTUFBSSxVQUFVLEdBQUcsTUFBTSxDQUFDLFVBQVAsQ0FBa0IsT0FBbEIsQ0FBMEIsWUFBMUIsQ0FBakI7QUFDQSxNQUFJLFdBQVcsR0FBRyxNQUFNLENBQUMsVUFBUCxDQUFrQixPQUFsQixDQUEwQixhQUExQixDQUFsQjtBQUNBLE1BQUksYUFBYSxHQUFHLE1BQU0sQ0FBQyxVQUFQLENBQWtCLE9BQWxCLENBQTBCLGVBQTFCLENBQXBCOztBQUVBLFdBQVMsUUFBVCxHQUFxQjtBQUNuQixJQUFBLFFBQVEsQ0FBQyxJQUFULENBQWMsU0FBZCxJQUEyQixXQUFXLENBQUM7QUFBRSxNQUFBLFVBQVUsRUFBRSxhQUFkO0FBQTZCLE1BQUEsVUFBVSxFQUFFLFVBQVUsQ0FBQyxFQUFEO0FBQW5E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QUFaO0FBRUEsTUFBQSxZQUFZO0FBQ1osTUFBQSxXQUFXLEdBTE0sQ0FPakI7O0FBQ0EsTUFBQSxVQUFVLENBQUMsWUFBWTtBQUFFLFFBQUEsZ0JBQWdCLENBQUMsUUFBRCxDQUFoQjtBQUE2QixPQUE1QyxFQUE4QyxJQUE5QyxDQUFWO0FBQ0QsS0FURDtBQVVELEdBOUVEOztBQWdGQSxFQUFBLGdCQUFnQixDQUFDLHlCQUFELENBQWhCO0FBQ0Q7O0FBRUQsQ0FBQyxZQUFZO0FBQ1gsRUFBQSxNQUFNLENBQUMsZ0JBQVAsQ0FBd0Isa0JBQXhCLEVBQTRDLElBQTVDO0FBQ0QsQ0FGRCIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKCl7ZnVuY3Rpb24gcihlLG4sdCl7ZnVuY3Rpb24gbyhpLGYpe2lmKCFuW2ldKXtpZighZVtpXSl7dmFyIGM9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZTtpZighZiYmYylyZXR1cm4gYyhpLCEwKTtpZih1KXJldHVybiB1KGksITApO3ZhciBhPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIraStcIidcIik7dGhyb3cgYS5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGF9dmFyIHA9bltpXT17ZXhwb3J0czp7fX07ZVtpXVswXS5jYWxsKHAuZXhwb3J0cyxmdW5jdGlvbihyKXt2YXIgbj1lW2ldWzFdW3JdO3JldHVybiBvKG58fHIpfSxwLHAuZXhwb3J0cyxyLGUsbix0KX1yZXR1cm4gbltpXS5leHBvcnRzfWZvcih2YXIgdT1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlLGk9MDtpPHQubGVuZ3RoO2krKylvKHRbaV0pO3JldHVybiBvfXJldHVybiByfSkoKSIsIid1c2Ugc3RyaWN0JztcclxuXHJcbmZ1bmN0aW9uIGxvYWQgKCkge1xyXG4gIGNvbnN0IG1vZGFsVGVtcGxhdGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbW9kYWxUZW1wbGF0ZScpLmlubmVySFRNTDtcclxuICBjb25zdCBhdmF0YXJUZW1wbGF0ZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhdmF0YXJUZW1wbGF0ZScpLmlubmVySFRNTDtcclxuICBjb25zdCBhdXRoVGVtcGxhdGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYXV0aGVudGljYXRpb25UZW1wbGF0ZScpLmlubmVySFRNTDtcclxuICBjb25zdCB1c2Vyc1RlbXBsYXRlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3VzZXJzVGVtcGxhdGUnKS5pbm5lckhUTUw7XHJcbiAgY29uc3QgbWVzc2FnZVRlbXBsYXRlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21lc3NhZ2VUZW1wbGF0ZScpLmlubmVySFRNTDtcclxuXHJcbiAgbGV0IG1vZGFsUmVuZGVyID0gZ2xvYmFsLkhhbmRsZWJhcnMuY29tcGlsZShtb2RhbFRlbXBsYXRlKTtcclxuICBsZXQgYXZhdGFyUmVuZGVyID0gZ2xvYmFsLkhhbmRsZWJhcnMuY29tcGlsZShhdmF0YXJUZW1wbGF0ZSk7XHJcbiAgbGV0IGF1dGhSZW5kZXIgPSBnbG9iYWwuSGFuZGxlYmFycy5jb21waWxlKGF1dGhUZW1wbGF0ZSk7XHJcbiAgbGV0IHVzZXJzUmVuZGVyID0gZ2xvYmFsLkhhbmRsZWJhcnMuY29tcGlsZSh1c2Vyc1RlbXBsYXRlKTtcclxuICBsZXQgbWVzc2FnZVJlbmRlciA9IGdsb2JhbC5IYW5kbGViYXJzLmNvbXBpbGUobWVzc2FnZVRlbXBsYXRlKTtcclxuXHJcbiAgZnVuY3Rpb24gc2hvd0F1dGggKCkge1xyXG4gICAgZG9jdW1lbnQuYm9keS5pbm5lckhUTUwgKz0gbW9kYWxSZW5kZXIoeyB3aW5kb3dOYW1lOiAn0JDQstGC0L7RgNC40LfQsNGG0LjRjycsIHdpbmRvd0JvZHk6IGF1dGhSZW5kZXIoe30pIH0pO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gc2hvd0F2YXRhckNoYW5nZXIgKCkge1xyXG4gICAgZG9jdW1lbnQuYm9keS5pbm5lckhUTUwgKz0gbW9kYWxSZW5kZXIoeyB3aW5kb3dOYW1lOiAn0KHQvNC10L3QsCDQsNCy0LDRgtCw0YDQsCcsIHdpbmRvd0JvZHk6IGF2YXRhclJlbmRlcih7fSkgfSk7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiByZW1vdmVNb2RhbCAoKSB7XHJcbiAgICBsZXQgbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbW9kYWwnKTtcclxuICAgIGlmIChtb2RhbCkgeyBtb2RhbC5vdXRlckhUTUwgPSAnJzsgfVxyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gY2hhbmdlQ2hhdE5hbWUgKGZpcnN0TmFtZSwgbGFzdE5hbWUpIHtcclxuICAgIGxldCBuYW1lRWxlbSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjaGF0VXNlck5hbWUnKTtcclxuICAgIG5hbWVFbGVtLmlubmVyVGV4dCA9IGAke2ZpcnN0TmFtZX0gJHtsYXN0TmFtZX1gO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gY2hhbmdlQXZhdGFyIChzcmMpIHtcclxuICAgIGxldCBhdmF0YXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcudXNlci1wcm9maWxlX19hdmF0YXIgaW1nJyk7XHJcbiAgICBhdmF0YXIuc3JjID0gc3JjO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gY2hhbmdlUHJldmlldyAoc3JjKSB7XHJcbiAgICBsZXQgYXZhdGFyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmRyYWctbi1kcm9wX19wcmV2aWV3Jyk7XHJcbiAgICBhdmF0YXIuc3JjID0gc3JjO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gY2hhbmdlQXZhdGFyTWVzc2FnZSAodXNlcklkLCBzcmMpIHtcclxuICAgIGxldCBhbGxNZXNzYWdlcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoYGxpW2RhdGEtdXNlci1pZD1cIiR7dXNlcklkfVwiXSBpbWdgKTtcclxuXHJcbiAgICBhbGxNZXNzYWdlcy5mb3JFYWNoKGVsZW0gPT4ge1xyXG4gICAgICBlbGVtLnNldEF0dHJpYnV0ZSgnc3JjJywgc3JjKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gbGlzdFNjcm9sbFRvQm90dG9tIChlbGVtKSB7XHJcbiAgICBlbGVtLnNjcm9sbFRvcCA9IGVsZW0uc2Nyb2xsSGVpZ2h0O1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gcmVuZGVyVXNlckxpc3RQYW5lbCAoZGF0YSkge1xyXG4gICAgbGV0IGNoYXRQYW5lbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjaGF0UGFuZWwnKTtcclxuICAgIGNoYXRQYW5lbC5pbm5lckhUTUwgPSB1c2Vyc1JlbmRlcihkYXRhKTtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIHNob3dDaGF0QXJlYSAoKSB7XHJcbiAgICBsZXQgY2hhdEFyZWEgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2hhdCcpO1xyXG4gICAgY2hhdEFyZWEuc3R5bGUub3BhY2l0eSA9ICcxJztcclxuICAgIGNoYXRBcmVhLm9mZnNldEhlaWdodDtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIGhpZGVDaGF0QXJlYSAoKSB7XHJcbiAgICBsZXQgY2hhdEFyZWEgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2hhdCcpO1xyXG4gICAgY2hhdEFyZWEuc3R5bGUub3BhY2l0eSA9ICcwJztcclxuICAgIGNoYXRBcmVhLm9mZnNldEhlaWdodDtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIHBhcnNlVGltZSAodGltZSkge1xyXG4gICAgdGltZSA9IG5ldyBEYXRlKHRpbWUpO1xyXG5cclxuICAgIHRpbWUgPSAodGltZS5nZXRIb3VycygpIDwgMTAgPyAnMCcgKyB0aW1lLmdldEhvdXJzKCkgOiB0aW1lLmdldEhvdXJzKCkpICsgJzonICtcclxuICAgICAgICAodGltZS5nZXRNaW51dGVzKCkgPCAxMCA/ICcwJyArIHRpbWUuZ2V0TWludXRlcygpIDogdGltZS5nZXRNaW51dGVzKCkpICsgJzonICtcclxuICAgICAgICAodGltZS5nZXRTZWNvbmRzKCkgPCAxMCA/ICcwJyArIHRpbWUuZ2V0U2Vjb25kcygpIDogdGltZS5nZXRTZWNvbmRzKCkpO1xyXG5cclxuICAgIHJldHVybiB0aW1lO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gcmVtb3ZlQW5pbWF0aW9uIChtZXNzYWdlSWQsIHRpbWUpIHtcclxuICAgIGxldCBlbGVtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgbGlbZGF0YS1tZXNzYWdlLWlkPVwiJHttZXNzYWdlSWR9XCJdYCk7XHJcblxyXG4gICAgc2V0VGltZW91dCgoKSA9PiB7IGVsZW0uY2xhc3NMaXN0LnJlbW92ZSgnZmFkZS1pbicpOyB9LCB0aW1lKTtcclxuICB9XHJcblxyXG4gIGxldCBmaWxlUmVhZGVyO1xyXG4gIGxldCByZXN1bHQ7XHJcbiAgbGV0IGRyYWdBbmREcm9wO1xyXG4gIGxldCBkcmFnVGltZW91dDtcclxuICBsZXQgZHJhZ1pvbmVUaW1lb3V0O1xyXG5cclxuICBsZXQgZXZlbnRzT2JqZWN0ID0ge1xyXG4gICAgb25VcGxvYWRDaGFuZ2UgKGUpIHtcclxuICAgICAgbGV0IGZpbGUgPSBlLnRhcmdldC5maWxlc1swXTtcclxuXHJcbiAgICAgIGZpbGVSZWFkZXIgPSBuZXcgZ2xvYmFsLkZpbGVSZWFkZXIoKTtcclxuXHJcbiAgICAgIGZpbGVSZWFkZXIuYWRkRXZlbnRMaXN0ZW5lcignbG9hZGVuZCcsIHRoaXMub25FbmQuYmluZCh0aGlzKSk7XHJcblxyXG4gICAgICBpZiAoZmlsZSAmJiBmaWxlLnR5cGUgPT09ICdpbWFnZS9qcGVnJykge1xyXG4gICAgICAgIGZpbGVSZWFkZXIucmVhZEFzRGF0YVVSTChmaWxlKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICB3aW5kb3cuYWxlcnQoJ9Cf0L7QttCw0LvRg9C50YHRgtCwLCDQstGL0LHQtdGA0LjRgtC1INGE0LDQudC7INGBINGA0LDRgdGI0LjRgNC10L3QuNC10LwganBlZy4nKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgZS50YXJnZXQucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgdGhpcy5vblVwbG9hZENoYW5nZSk7XHJcbiAgICB9LFxyXG4gICAgb25FbmQgKCkge1xyXG4gICAgICByZXN1bHQgPSB7XHJcbiAgICAgICAgdHlwZTogJ3VzZXItYXZhdGFyJyxcclxuICAgICAgICBkYXRhOiBmaWxlUmVhZGVyLnJlc3VsdFxyXG4gICAgICB9O1xyXG5cclxuICAgICAgY2hhbmdlUHJldmlldyhmaWxlUmVhZGVyLnJlc3VsdCk7XHJcbiAgICAgIGZpbGVSZWFkZXIucmVtb3ZlRXZlbnRMaXN0ZW5lcignbG9hZGVuZCcsIHRoaXMub25FbmQpO1xyXG4gICAgfSxcclxuICAgIG9uRHJhZyAoZSkge1xyXG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcblxyXG4gICAgICBjb25zb2xlLmxvZygnQ2xhc3M6IGV2ZW50c09iamVjdCwgTGluZTogMTE2ICcsIGUpO1xyXG4gICAgfSxcclxuICAgIHByZXZlbnREZWZhdWx0cyAoZSkge1xyXG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICB9LFxyXG4gICAgaGlnaGxpZ2h0ICgpIHtcclxuICAgICAgZHJhZ0FuZERyb3AuY2xhc3NMaXN0LmFkZCgnaGlnaGxpZ2h0Jyk7XHJcbiAgICB9LFxyXG4gICAgdW5oaWdobGlnaHQgKCkge1xyXG4gICAgICBkcmFnQW5kRHJvcC5jbGFzc0xpc3QucmVtb3ZlKCdoaWdobGlnaHQnKTtcclxuICAgIH0sXHJcbiAgICBvbkVudGVyICgpIHtcclxuICAgICAgaWYgKCFkcmFnQW5kRHJvcCkgeyByZXR1cm47IH1cclxuXHJcbiAgICAgIGRyYWdBbmREcm9wLmNsYXNzTGlzdC5hZGQoJ3ByZXBhcmUnKTtcclxuICAgIH0sXHJcbiAgICBvbkVuZERyYWcgKCkge1xyXG4gICAgICBkcmFnQW5kRHJvcC5jbGFzc0xpc3QucmVtb3ZlKCdwcmVwYXJlJyk7XHJcbiAgICB9LFxyXG4gICAgb25EcmFnT3ZlciAoKSB7XHJcbiAgICAgIGlmICghZHJhZ0FuZERyb3ApIHsgcmV0dXJuOyB9XHJcblxyXG4gICAgICBpZiAoZHJhZ1RpbWVvdXQgIT09IHVuZGVmaW5lZCkgeyB3aW5kb3cuY2xlYXJUaW1lb3V0KGRyYWdUaW1lb3V0KTsgfVxyXG5cclxuICAgICAgZHJhZ1RpbWVvdXQgPSB3aW5kb3cuc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgZXZlbnRzT2JqZWN0Lm9uRW5kRHJhZygpO1xyXG4gICAgICB9LCAyMDApO1xyXG4gICAgfSxcclxuICAgIG9uRHJhZ0VudGVyWm9uZSAoKSB7XHJcbiAgICAgIGRyYWdBbmREcm9wLmNsYXNzTGlzdC5hZGQoJ2hpZ2hsaWdodCcpO1xyXG4gICAgfSxcclxuICAgIG9uRHJhZ092ZXJab25lICgpIHtcclxuICAgICAgaWYgKCFkcmFnQW5kRHJvcCkgeyByZXR1cm47IH1cclxuXHJcbiAgICAgIGV2ZW50c09iamVjdC5vbkRyYWdPdmVyKCk7XHJcblxyXG4gICAgICBpZiAoZHJhZ1pvbmVUaW1lb3V0ICE9PSB1bmRlZmluZWQpIHsgd2luZG93LmNsZWFyVGltZW91dChkcmFnWm9uZVRpbWVvdXQpOyB9XHJcblxyXG4gICAgICBkcmFnWm9uZVRpbWVvdXQgPSB3aW5kb3cuc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgZHJhZ0FuZERyb3AuY2xhc3NMaXN0LnJlbW92ZSgnaGlnaGxpZ2h0Jyk7XHJcbiAgICAgIH0sIDIwMCk7XHJcbiAgICB9LFxyXG4gICAgb25Ecm9wWm9uZSAoZSkge1xyXG4gICAgICBsZXQgdXBsb2FkZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW1nVXBsb2FkJyk7XHJcbiAgICAgIGxldCBkcm9wZWRGaWxlcyA9IGUuZGF0YVRyYW5zZmVyLmZpbGVzO1xyXG5cclxuICAgICAgaWYgKHVwbG9hZGVyKSB7XHJcbiAgICAgICAgdXBsb2FkZXIuZmlsZXMgPSBkcm9wZWRGaWxlcztcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHVwbG9hZGVyLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIGV2ZW50c09iamVjdC5vblVwbG9hZENoYW5nZS5iaW5kKGV2ZW50c09iamVjdCkpO1xyXG4gICAgICB1cGxvYWRlci5kaXNwYXRjaEV2ZW50KG5ldyBnbG9iYWwuRXZlbnQoJ2NoYW5nZScpKTtcclxuICAgIH0sXHJcbiAgICBkb0RuRExpc3RlbmVycyAoZHJhZ0FuZERyb3AsIHdoYXQpIHtcclxuICAgICAgbGV0IHdoYXRUb0RvO1xyXG5cclxuICAgICAgaWYgKHdoYXQgPT09ICd1bnNldCcpIHtcclxuICAgICAgICB3aGF0VG9EbyA9ICdyZW1vdmVFdmVudExpc3RlbmVyJztcclxuICAgICAgfSBlbHNlIGlmICh3aGF0ID09PSAnc2V0Jykge1xyXG4gICAgICAgIHdoYXRUb0RvID0gJ2FkZEV2ZW50TGlzdGVuZXInO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG5cclxuICAgICAgWydkcmFnZW50ZXInLCAnZHJhZ292ZXInLCAnZHJhZ2xlYXZlJywgJ2Ryb3AnXS5mb3JFYWNoKGV2ZW50TmFtZSA9PiB7XHJcbiAgICAgICAgZHJhZ0FuZERyb3Bbd2hhdFRvRG9dKGV2ZW50TmFtZSwgZXZlbnRzT2JqZWN0LnByZXZlbnREZWZhdWx0cyk7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgZHJhZ0FuZERyb3Bbd2hhdFRvRG9dKCdkcmFnZW50ZXInLCBldmVudHNPYmplY3Qub25EcmFnRW50ZXJab25lLCBmYWxzZSk7XHJcbiAgICAgIGRyYWdBbmREcm9wW3doYXRUb0RvXSgnZHJhZ292ZXInLCBldmVudHNPYmplY3Qub25EcmFnT3ZlclpvbmUsIGZhbHNlKTtcclxuICAgICAgZHJhZ0FuZERyb3Bbd2hhdFRvRG9dKCdkcm9wJywgZXZlbnRzT2JqZWN0Lm9uRHJvcFpvbmUsIGZhbHNlKTtcclxuICAgIH1cclxuICB9O1xyXG5cclxuICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdkcmFnZW50ZXInLCBldmVudHNPYmplY3Qub25FbnRlciwgZmFsc2UpO1xyXG4gIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdvdmVyJywgZXZlbnRzT2JqZWN0Lm9uRHJhZ092ZXIsIGZhbHNlKTtcclxuXHJcbiAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4ge1xyXG4gICAgaWYgKGUudGFyZ2V0LnBhcmVudEVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKCd1c2VyLXByb2ZpbGVfX2F2YXRhcicpKSB7XHJcbiAgICAgIHNob3dBdmF0YXJDaGFuZ2VyKCk7XHJcblxyXG4gICAgICBkcmFnQW5kRHJvcCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5kcmFnLW4tZHJvcF9fem9uZScpO1xyXG5cclxuICAgICAgZXZlbnRzT2JqZWN0LmRvRG5ETGlzdGVuZXJzKGRyYWdBbmREcm9wLCAnc2V0Jyk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKGUudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnZHJhZy1uLWRyb3BfX2FkZCcpKSB7XHJcbiAgICAgIGxldCB1cGxvYWRlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbWdVcGxvYWQnKTtcclxuICAgICAgZHJhZ0FuZERyb3AgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuZHJhZy1uLWRyb3BfX3pvbmUnKTtcclxuXHJcbiAgICAgIHVwbG9hZGVyLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIGV2ZW50c09iamVjdC5vblVwbG9hZENoYW5nZS5iaW5kKGV2ZW50c09iamVjdCkpO1xyXG4gICAgICB1cGxvYWRlci5kaXNwYXRjaEV2ZW50KG5ldyB3aW5kb3cuTW91c2VFdmVudCgnY2xpY2snKSk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKGUudGFyZ2V0LmdldEF0dHJpYnV0ZSgnaWQnKSA9PT0gKCdzYXZlQnRuQXZhdGFyJykpIHtcclxuICAgICAgaWYgKHJlc3VsdCkge1xyXG4gICAgICAgIHdzLnNlbmQoSlNPTi5zdHJpbmdpZnkocmVzdWx0KSk7XHJcbiAgICAgICAgZXZlbnRzT2JqZWN0LmRvRG5ETGlzdGVuZXJzKGRyYWdBbmREcm9wLCAndW5zZXQnKTtcclxuICAgICAgICByZW1vdmVNb2RhbCgpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHdpbmRvdy5hbGVydCgn0KTQvtGC0L4g0L3QtSDQstGL0LHRgNCw0L3Qvi4nKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGlmIChlLnRhcmdldC5nZXRBdHRyaWJ1dGUoJ2lkJykgPT09ICgnY2FuY2VsQnRuQXZhdGFyJykpIHtcclxuICAgICAgZXZlbnRzT2JqZWN0LmRvRG5ETGlzdGVuZXJzKGRyYWdBbmREcm9wLCAndW5zZXQnKTtcclxuICAgICAgcmVtb3ZlTW9kYWwoKTtcclxuICAgIH1cclxuICB9KTtcclxuXHJcbiAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignc3VibWl0JywgKGUpID0+IHtcclxuICAgIGlmIChlLnRhcmdldC5nZXRBdHRyaWJ1dGUoJ2lkJykgPT09ICdhdXRoJykge1xyXG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcblxyXG4gICAgICBsZXQgZm5hbWVJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmbmFtZScpO1xyXG4gICAgICBsZXQgbG5hbWVJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsbmFtZScpO1xyXG5cclxuICAgICAgaWYgKGZuYW1lSW5wdXQudmFsdWUubGVuZ3RoID4gMiAmJiBsbmFtZUlucHV0LnZhbHVlLmxlbmd0aCA+IDIpIHtcclxuICAgICAgICBsZXQgdXNlckRhdGEgPSB7XHJcbiAgICAgICAgICBmdWxsTmFtZTogYCR7Zm5hbWVJbnB1dC52YWx1ZX0gJHtsbmFtZUlucHV0LnZhbHVlfWAsXHJcbiAgICAgICAgICBmaXJzdE5hbWU6IGZuYW1lSW5wdXQudmFsdWUsXHJcbiAgICAgICAgICBsYXN0TmFtZTogbG5hbWVJbnB1dC52YWx1ZSxcclxuICAgICAgICAgIHR5cGU6ICd1c2VyLWpvaW4nXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgd3Muc2VuZChKU09OLnN0cmluZ2lmeSh1c2VyRGF0YSkpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKGUudGFyZ2V0LmdldEF0dHJpYnV0ZSgnaWQnKSA9PT0gJ21lc3NhZ2VGb3JtJykge1xyXG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcblxyXG4gICAgICBsZXQgbWVzc2FnZUlucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21lc3NhZ2VJbnB1dCcpO1xyXG5cclxuICAgICAgaWYgKG1lc3NhZ2VJbnB1dC52YWx1ZS5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgbGV0IGRhdGFUb1NlbmQgPSB7XHJcbiAgICAgICAgICBtZXNzYWdlOiBtZXNzYWdlSW5wdXQudmFsdWUsXHJcbiAgICAgICAgICBmdWxsTmFtZTogdXNlckluZm8uZnVsbE5hbWUsXHJcbiAgICAgICAgICB0eXBlOiAndXNlci1tZXNzYWdlJ1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHdzLnNlbmQoSlNPTi5zdHJpbmdpZnkoZGF0YVRvU2VuZCkpO1xyXG5cclxuICAgICAgICBtZXNzYWdlSW5wdXQudmFsdWUgPSAnJztcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH0pO1xyXG5cclxuICAvL1xyXG4gIC8vIFdlYlNvY2tldFxyXG4gIC8vXHJcblxyXG4gIGxldCB3cztcclxuICBsZXQgdXNlckluZm8gPSB7fTtcclxuICBsZXQgdXNlcnNEYXRhID0gW107XHJcblxyXG4gIGxldCB3ZWJTb2NrZXRDb25uZWN0ID0gKGxvY2F0aW9uKSA9PiB7XHJcbiAgICB3aW5kb3cuV2ViU29ja2V0ID0gd2luZG93LldlYlNvY2tldCB8fCB3aW5kb3cuTW96V2ViU29ja2V0O1xyXG5cclxuICAgIHdzID0gbmV3IHdpbmRvdy5XZWJTb2NrZXQobG9jYXRpb24pO1xyXG5cclxuICAgIHdzLm9ub3BlbiA9ICgpID0+IHtcclxuICAgICAgc2hvd0F1dGgoKTtcclxuICAgIH07XHJcblxyXG4gICAgd3Mub25tZXNzYWdlID0gKG1lc3NhZ2UpID0+IHtcclxuICAgICAgbGV0IGRhdGEgPSBKU09OLnBhcnNlKG1lc3NhZ2UuZGF0YSk7XHJcbiAgICAgIGxldCB1c2VyID0gZGF0YS51c2VySWQgPyB1c2Vyc0RhdGEuZmluZChlbGVtID0+IGVsZW0udXNlcklkID09PSBkYXRhLnVzZXJJZCkgfHwge30gOiB7fTtcclxuXHJcbiAgICAgIGlmIChkYXRhLnR5cGUgPT09ICd1c2VyLWpvaW4nKSB7XHJcbiAgICAgICAgY2hhbmdlQ2hhdE5hbWUoZGF0YS5maXJzdE5hbWUsIGRhdGEubGFzdE5hbWUpO1xyXG4gICAgICAgIHJlbW92ZU1vZGFsKCk7XHJcbiAgICAgICAgc2hvd0NoYXRBcmVhKCk7XHJcblxyXG4gICAgICAgIHVzZXJJbmZvID0gZGF0YTtcclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKGRhdGEudHlwZSA9PT0gJ3VzZXJzLWxpc3QnKSB7XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDAsIGVsZW07IGkgPCBkYXRhLmNvdW50OyArK2kpIHtcclxuICAgICAgICAgIGVsZW0gPSBkYXRhLnVzZXJzW2ldO1xyXG5cclxuICAgICAgICAgIGxldCBmaW5kVXNlciA9IHVzZXJzRGF0YS5maW5kKHVzZXJEYXRhID0+IHVzZXJEYXRhLnVzZXJJZCA9PT0gZWxlbS5pZCk7XHJcblxyXG4gICAgICAgICAgaWYgKCFmaW5kVXNlcikgeyB1c2Vyc0RhdGEucHVzaChlbGVtKTsgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmVuZGVyVXNlckxpc3RQYW5lbCh7IHVzZXJzOiB1c2Vyc0RhdGEsIGNvdW50OiB1c2Vyc0RhdGEubGVuZ3RoIH0pO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAoZGF0YS50eXBlID09PSAndXNlci1hZGQnKSB7XHJcbiAgICAgICAgdXNlcnNEYXRhLnB1c2goZGF0YSk7XHJcblxyXG4gICAgICAgIHJlbmRlclVzZXJMaXN0UGFuZWwoeyB1c2VyczogdXNlcnNEYXRhLCBjb3VudDogdXNlcnNEYXRhLmxlbmd0aCB9KTtcclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKGRhdGEudHlwZSA9PT0gJ3VzZXItbWVzc2FnZScpIHtcclxuICAgICAgICBsZXQgbWVzc2FnZUxpc3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWVzc2FnZUxpc3QnKTtcclxuXHJcbiAgICAgICAgZGF0YS50aW1lID0gcGFyc2VUaW1lKGRhdGEudGltZSk7XHJcbiAgICAgICAgZGF0YS5hdmF0YXIgPSB1c2VyLmF2YXRhciB8fCAnLi9pbWcvYXZhdGFyLnBuZyc7XHJcblxyXG4gICAgICAgIG1lc3NhZ2VMaXN0LmlubmVySFRNTCArPSBtZXNzYWdlUmVuZGVyKGRhdGEpO1xyXG5cclxuICAgICAgICByZW1vdmVBbmltYXRpb24oZGF0YS5tZXNzYWdlSWQsIDEwNzApO1xyXG4gICAgICAgIGxpc3RTY3JvbGxUb0JvdHRvbShtZXNzYWdlTGlzdCk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmIChkYXRhLnR5cGUgPT09ICd1c2VyLWF2YXRhcicpIHtcclxuICAgICAgICBpZiAoZGF0YS51c2VySWQgPT09IHVzZXJJbmZvLnVzZXJJZCkgeyBjaGFuZ2VBdmF0YXIoZGF0YS5kYXRhKTsgfVxyXG5cclxuICAgICAgICB1c2VyWydhdmF0YXInXSA9IGRhdGEuZGF0YTtcclxuXHJcbiAgICAgICAgY2hhbmdlQXZhdGFyTWVzc2FnZShkYXRhLnVzZXJJZCwgZGF0YS5kYXRhKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKGRhdGEudHlwZSA9PT0gJ3VzZXItcmVtb3ZlJykge1xyXG4gICAgICAgIGxldCBpbmRleERlbCA9IHVzZXJzRGF0YS5maW5kSW5kZXgoZWxlbSA9PiBlbGVtLnVzZXJJZCA9PT0gZGF0YS51c2VySWQpO1xyXG5cclxuICAgICAgICBpZiAoaW5kZXhEZWwgIT09IHVuZGVmaW5lZCkgeyB1c2Vyc0RhdGEuc3BsaWNlKGluZGV4RGVsLCAxKTsgfVxyXG5cclxuICAgICAgICByZW5kZXJVc2VyTGlzdFBhbmVsKHsgdXNlcnM6IHVzZXJzRGF0YSwgY291bnQ6IHVzZXJzRGF0YS5sZW5ndGggfSk7XHJcbiAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgd3Mub25jbG9zZSA9ICgpID0+IHtcclxuICAgICAgdXNlckluZm8gPSB7fTtcclxuICAgICAgdXNlcnNEYXRhID0gW107XHJcblxyXG4gICAgICBoaWRlQ2hhdEFyZWEoKTtcclxuICAgICAgcmVtb3ZlTW9kYWwoKTtcclxuXHJcbiAgICAgIC8vIFRyeSByZWNvbm5lY3QgZXZlcnkgMi41IHNlYy5cclxuICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7IHdlYlNvY2tldENvbm5lY3QobG9jYXRpb24pOyB9LCAyNTAwKTtcclxuICAgIH07XHJcbiAgfTtcclxuXHJcbiAgd2ViU29ja2V0Q29ubmVjdCgnd3M6Ly8xOTIuMTY4LjAuMTAwOjgwODUnKTtcclxufVxyXG5cclxuKGZ1bmN0aW9uICgpIHtcclxuICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIGxvYWQpO1xyXG59KSgpO1xyXG4iXX0=
