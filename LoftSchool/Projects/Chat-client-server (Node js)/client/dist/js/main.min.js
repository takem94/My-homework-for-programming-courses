!function o(i,d,s){function u(t,e){if(!d[t]){if(!i[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(c)return c(t,!0);var r=new Error("Cannot find module '"+t+"'");throw r.code="MODULE_NOT_FOUND",r}var a=d[t]={exports:{}};i[t][0].call(a.exports,function(e){return u(i[t][1][e]||e)},a,a.exports,o,i,d,s)}return d[t].exports}for(var c="function"==typeof require&&require,e=0;e<s.length;e++)u(s[e]);return u}({1:[function(e,t,n){(function(p){"use strict";function e(){var n,r,a,e,t,o=document.getElementById("modalTemplate").innerHTML,i=document.getElementById("avatarTemplate").innerHTML,d=document.getElementById("authenticationTemplate").innerHTML,s=document.getElementById("usersTemplate").innerHTML,u=document.getElementById("messageTemplate").innerHTML,c=p.Handlebars.compile(o),l=p.Handlebars.compile(i),g=p.Handlebars.compile(d),m=p.Handlebars.compile(s),E=p.Handlebars.compile(u);function w(){var e=document.getElementById("modal");e&&(e.outerHTML="")}function L(e){document.getElementById("chatPanel").innerHTML=m(e)}var f,v={onUploadChange:function(e){var t=e.target.files[0];(n=new p.FileReader).addEventListener("loadend",this.onEnd.bind(this)),t&&"image/jpeg"===t.type?n.readAsDataURL(t):window.alert("Пожалуйста, выберите файл с расширением jpeg."),e.target.removeEventListener("change",this.onUploadChange)},onEnd:function(){var e;r={type:"user-avatar",data:n.result},e=n.result,document.querySelector(".drag-n-drop__preview").src=e,n.removeEventListener("loadend",this.onEnd)},onDrag:function(e){e.preventDefault(),console.log("Class: eventsObject, Line: 116 ",e)},preventDefaults:function(e){e.preventDefault(),e.stopPropagation()},highlight:function(){a.classList.add("highlight")},unhighlight:function(){a.classList.remove("highlight")},onEnter:function(){a&&a.classList.add("prepare")},onEndDrag:function(){a.classList.remove("prepare")},onDragOver:function(){a&&(void 0!==e&&window.clearTimeout(e),e=window.setTimeout(function(){v.onEndDrag()},200))},onDragEnterZone:function(){a.classList.add("highlight")},onDragOverZone:function(){a&&(v.onDragOver(),void 0!==t&&window.clearTimeout(t),t=window.setTimeout(function(){a.classList.remove("highlight")},200))},onDropZone:function(e){var t=document.getElementById("imgUpload"),n=e.dataTransfer.files;t&&(t.files=n,t.addEventListener("change",v.onUploadChange.bind(v)),t.dispatchEvent(new p.Event("change")))},doDnDListeners:function(t,e){var n;if("unset"===e)n="removeEventListener";else{if("set"!==e)return;n="addEventListener"}["dragenter","dragover","dragleave","drop"].forEach(function(e){t[n](e,v.preventDefaults)}),t[n]("dragenter",v.onDragEnterZone,!1),t[n]("dragover",v.onDragOverZone,!1),t[n]("drop",v.onDropZone,!1)}};document.addEventListener("dragenter",v.onEnter,!1),document.addEventListener("dragover",v.onDragOver,!1),document.addEventListener("click",function(e){if(e.target.parentElement.classList.contains("user-profile__avatar")&&(document.body.innerHTML+=c({windowName:"Смена аватара",windowBody:l({})}),a=document.querySelector(".drag-n-drop__zone"),v.doDnDListeners(a,"set")),e.target.classList.contains("drag-n-drop__add")){var t=document.getElementById("imgUpload");a=document.querySelector(".drag-n-drop__zone"),t.addEventListener("change",v.onUploadChange.bind(v)),t.dispatchEvent(new window.MouseEvent("click"))}"saveBtnAvatar"===e.target.getAttribute("id")&&(r?(f.send(JSON.stringify(r)),v.doDnDListeners(a,"unset"),w()):window.alert("Фото не выбрано.")),"cancelBtnAvatar"===e.target.getAttribute("id")&&(v.doDnDListeners(a,"unset"),w())}),document.addEventListener("submit",function(e){if("auth"===e.target.getAttribute("id")){e.preventDefault();var t=document.getElementById("fname"),n=document.getElementById("lname");if(2<t.value.length&&2<n.value.length){var r={fullName:"".concat(t.value," ").concat(n.value),firstName:t.value,lastName:n.value,type:"user-join"};f.send(JSON.stringify(r))}}if("messageForm"===e.target.getAttribute("id")){e.preventDefault();var a=document.getElementById("messageInput");if(0<a.value.length){var o={message:a.value,fullName:D.fullName,type:"user-message"};f.send(JSON.stringify(o)),a.value=""}}});var D={},I=[];!function t(n){window.WebSocket=window.WebSocket||window.MozWebSocket,(f=new window.WebSocket(n)).onopen=function(){document.body.innerHTML+=c({windowName:"Авторизация",windowBody:g({})})},f.onmessage=function(e){var t,n,r,a,o,i,d,s,u,c,l,g=JSON.parse(e.data),m=g.userId&&I.find(function(e){return e.userId===g.userId})||{};if("user-join"===g.type&&(n=g.firstName,r=g.lastName,document.getElementById("chatUserName").innerText="".concat(n," ").concat(r),w(),(t=document.getElementById("chat")).style.opacity="1",t.offsetHeight,D=g),"users-list"===g.type){for(var f,v=function(e,t){t=g.users[e],I.find(function(e){return e.userId===t.id})||I.push(t),f=t},p=0;p<g.count;++p)v(p,f);L({users:I,count:I.length})}if("user-add"===g.type&&(I.push(g),L({users:I,count:I.length})),"user-message"===g.type){var h=document.getElementById("messageList");g.time=(s=g.time,s=((s=new Date(s)).getHours()<10?"0"+s.getHours():s.getHours())+":"+(s.getMinutes()<10?"0"+s.getMinutes():s.getMinutes())+":"+(s.getSeconds()<10?"0"+s.getSeconds():s.getSeconds())),g.avatar=m.avatar||"./img/avatar.png",h.innerHTML+=E(g),o=g.messageId,i=1070,d=document.querySelector('li[data-message-id="'.concat(o,'"]')),setTimeout(function(){d.classList.remove("fade-in")},i),(a=h).scrollTop=a.scrollHeight}if("user-avatar"===g.type&&(g.userId===D.userId&&(l=g.data,document.querySelector(".user-profile__avatar img").src=l),m.avatar=g.data,u=g.userId,c=g.data,document.querySelectorAll('li[data-user-id="'.concat(u,'"] img')).forEach(function(e){e.setAttribute("src",c)})),"user-remove"===g.type){var y=I.findIndex(function(e){return e.userId===g.userId});void 0!==y&&I.splice(y,1),L({users:I,count:I.length})}},f.onclose=function(){var e;D={},I=[],(e=document.getElementById("chat")).style.opacity="0",e.offsetHeight,w(),setTimeout(function(){t(n)},2500)}}("ws://192.168.0.100:8085")}window.addEventListener("DOMContentLoaded",e)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[1]);