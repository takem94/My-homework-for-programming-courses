function Basket(t,e,a,s){Container.call(this,t),this.countGoods=0,this.amount=0,this.basketItems=[],this.basketList=e,this.basketTotalPrice=a,this.basketNotCounter=s,this.loadBasketItems()}function Container(t){this.id=t,this.htmlCode=""}function ExtendedBasket(t,e,a,s,n,r,i,o){Basket.call(this,t,e,a,s),this.extendItemTemplate=o,this.basketExtendList=n,this.tableTotalPrice=r,this.tableSubPrice=i,this.loadBasketItems()}function Good(t,e,a){Container.call(this,t),this.title=e,this.price=a}$(function(){var s,n,r,i=$(".features .features-items"),o=$(".products .features-items"),d=$(".similar .features-items"),t=$(".basket-table");function c(t){var e=$(t.target);if(e.hasClass("features-items__unit-btn")){for(var a=e.parent(),s=!1;!s;){if(e.hasClass("features-items__unit")){a=e.data("id"),s=!0;break}e=$(e.parent())}t.data.basket.add(parseInt(a),t.data.data)}}function p(t,e,a,s,n,r){var i=$("<div />",{class:"features-items__unit","data-id":r}),o=$("<div />",{class:"features-items__unit-img"}),d=$("<img />",{src:a,alt:s}),c=$("<button />",{text:"Add to Cart",class:"features-items__unit-btn"}),p=$("<div />",{text:t,class:"features-items__unit-title"}),l=$("<div />",{text:"$"+e+".00",class:"features-items__unit-price"}),u=$("<div />",{href:n,class:"features-items__link-wrapper"});return i.append(o.append(d).append(c)).append(p).append(l).append(u),i}function e(t){return $.ajax({url:t,dataType:"json",type:"get",contentType:"application/json"})}var l,a=$(".cart__product-list"),u=$(".cart__price-value"),h=$(".account-info__cart-counter");if(0<t.length){var f=$(".basket-table_template").remove().clone().removeClass("basket-table_template"),m=$(".basket-table__tbody"),_=$(".delivery-block__sub-total_value"),b=$(".delivery-block__grand-total_value");m.empty(),l=new ExtendedBasket(1,a,u,h,m,b,_,f)}else l=new Basket(1,a,u,h);var k=$(".reviews-slider"),v=$(".product-slider");0<k.length&&k.slick({infinite:!0,arrows:!1,slidesToShow:1,slidesToScroll:1,dots:!0,autoplay:!0,autoplaySpeed:3e3,draggable:!0});var g=document.getElementById("flatSlider");if(null!==g){var y=[document.getElementById("flatSliderMinValue"),document.getElementById("flatSliderMaxValue")];noUiSlider.create(g,{start:[50,400],connect:!0,step:1,range:{min:0,max:600}}),g.noUiSlider.on("update",function(t,e){y[e].innerHTML=Math.round(t[e])})}var x=$(".search-form__directory-select"),I=$(".account-info__cart-btn"),B=$(".cart"),C=$(".search-form__directory-option"),E=$(".search-form__dropdown"),w=$(".products-category"),T=$(".search-form__directory-unit"),j=$("section.product");0<w.length&&w.on("click",function(t){var e=t.target.parentElement;"false"==e.dataset.active||""==e?(e.dataset.active="true",t.target.classList.add("products-category__btn_active"),t.target.nextElementSibling.style.maxHeight="500px"):(e.dataset.active="false",t.target.classList.remove("products-category__btn_active"),t.target.nextElementSibling.style.maxHeight="0")}),T.on("click",function(t){t.preventDefault(),C.val(t.currentTarget.textContent).change(),C.text(t.currentTarget.textContent),E.hide()}),x.on("mousedown",function(t){t.preventDefault(),"none"===E.css("display")?E.show():E.hide()}),I.on("click",function(t){t.preventDefault(),"none"===B.css("display")?B.show():B.hide()}),0<i.length&&e("./json/featured.json").done(function(t){n=t;for(var e=0;e<t.length;++e){var a=t[e];i.append(p(a.title,a.price,a.img,"product-preview","#",a.id))}i.on("click",{data:n,basket:l},c)}),0<o.length&&e("./json/products.json").done(function(t){s=t;for(var e=0;e<t.length;++e){var a=t[e];o.append(p(a.title,a.price,a.img,"product-preview","#",a.id))}o.on("click",{data:s,basket:l},c)}),0<d.length&&e("./json/single-page.json").done(function(t){r=t;for(var e=0;e<t.length;++e){var a=t[e];d.append(p(a.title,a.price,a.img,"product-preview","#",a.id))}d.on("click",{data:r,basket:l},c)}),0<t.length&&($(".basket-controls__btn_del").on("click",function(){l.clean()}),m.on("input",function(t){if(t.target.classList.contains("basket-table__quantity-input")){t.target.value<1&&(t.target.value=1);var e=$(t.target.parentNode.parentNode);if(e.hasClass("basket-table__elem")){var a=e.data("id");l.changeAmount(a,t.target.value)}}}),m.on("click",function(t){var e=$(t.target),a="basket-table__btn-del";if(e.hasClass(a)||$(e.parent()).hasClass(a)){for(var s,n=!1;!n;){if(e.hasClass("basket-table__elem")){s=e.data("id"),n=!0;break}e=$(e.parent())}l.remove(parseInt(s))}})),0<j.length&&e("./json/single-page-product.json").done(function(n){for(var t in(n=n[0]).desc.slides){var e=$("<div />",{class:"product-slider__slide"}),a=$("<div />",{class:"product-slider__slide-img"}),s=$("<img />",{src:n.desc.slides[t],alt:"product"});e.append(a.append(s)),v.append(e)}var r=$(".product-slider img"),i=0,o=r.length;r.on("load",function(){++i===o&&v.slick({infinite:!0,arrows:!0,slidesToShow:1,slidesToScroll:1,dots:!1,autoplay:!0,autoplaySpeed:3e3,draggable:!0})}),$(".product-overview").data("id",n.id),$(".product-overview__collection-name").text(n.desc.collection),$(".product-overview__title").text(n.title),$(".product-overview__description").text(n.desc.text),$(".product-overview__info-material-value").text(n.desc.material),$(".product-overview__info-designer-value").text(n.desc.designer),$(".product-overview__price").text("$"+n.price+".00"),$("#productForm").on("submit",function(t){t.preventDefault();var e=$("#productSize"),a=$("#productColor"),s=$("#productCount");n.amount=parseInt(s.val()),n.size=e.val(),n.color=a.val(),l.add(n.id,[n])})}),a.on("click",function(t){var e=$(t.target),a="cart__product-btn-del";if(e.hasClass(a)||$(e.parent()).hasClass(a)){for(var s=e.parent(),n=!1;!n;){if(e.hasClass("cart__product-elem")){s=e.data("id"),n=!0;break}e=$(e.parent())}l.remove(parseInt(s))}})}),Basket.prototype=Object.create(Container.prototype),(Basket.prototype.constructor=Basket).prototype.render=function(){for(var t in this.basketItems){var e=this.basketItems[t],a=this.createElem("#",e.img,"Preview",e.title,e.rating,e.amount,e.price,e.id);this.basketList.append(a)}this.updateCountAndPrice(),this.renderCountAndPrice()},Basket.prototype.createElem=function(t,e,a,s,n,r,i,o){var d=$("<div />",{class:"cart__product-elem","data-id":o}),c=$("<div />",{class:"cart__product-preview"}),p=$("<a />",{href:t}),l=$("<img />",{src:e,alt:a}),u=$("<div />",{class:"cart__product-info"}),h=$("<a />",{class:"cart__product-title",href:t,text:s}),f=$("<div />",{class:"cart__product-rate"}),m=$("<p />",{class:"cart__product-price"}),_=$("<span />",{class:"cart__product-amount",text:r}),b=$("<span />",{class:"cart__product-price",text:"$"+i+".00"}),k=$("<button />",{class:"cart__product-btn-del"}),v=$("<i />",{class:"fa fa-times"});n=parseFloat(n);for(var g=4;0<=g;--g){var y;1<=n?(y=$("<i />",{class:"fa fa-star"}),--n):0<n?(y=$("<i />",{class:"fas fa-star-half-alt"}),--n):y=$("<i />",{class:"far fa-star"}),f.append(y)}return d.append(c.append(p.append(l))),m.append(_).append(" x ").append(b),d.append(u.append(h).append(f).append(m)),k.append(v),d.append(k),d},Basket.prototype.loadBasketItems=function(){$.get({url:"./json/basket.json",dataType:"json",context:this,success:function(t){this.basketItems=t,this.refresh()}})},Basket.prototype.add=function(t,e){var a,s=!1;for(var n in t=parseInt(t),e)if(parseInt(e[n].id)===t){a=n;break}for(var n in this.basketItems)if(t===parseInt(this.basketItems[n].id)){s=!0,1<e[a].amount?(this.basketItems[n].amount+=parseInt(e[a].amount),this.countGoods+=e[a].amount):(++this.basketItems[n].amount,++this.countGoods);break}if(!s){void 0===e[a].amount&&(e[a].amount=1);var r=JSON.parse(JSON.stringify(e[a]));this.basketItems.push(r)}this.refresh()},Basket.prototype.refresh=function(){this.basketList.empty(),this.render()},Basket.prototype.remove=function(t){for(var e in this.basketItems)if(t===parseInt(this.basketItems[e].id)){this.basketItems.splice(e,1);break}this.refresh()},Basket.prototype.updateCountAndPrice=function(){for(var t in this.amount=0,this.countGoods=0,this.basketItems){var e=this.basketItems[t];this.countGoods+=parseInt(e.amount),this.amount+=parseInt(e.amount)*parseInt(e.price)}},Basket.prototype.renderCountAndPrice=function(){0<this.countGoods?(this.basketNotCounter.text(this.countGoods),this.basketNotCounter.show()):this.basketNotCounter.hide(),this.basketTotalPrice.text("$"+this.amount+".00")},Container.prototype.render=function(){return this.htmlCode},Container.prototype.remove=function(){},ExtendedBasket.prototype=Object.create(Basket.prototype),(ExtendedBasket.prototype.constructor=ExtendedBasket).prototype.loadBasketItems=function(){$.get({url:"./json/cart-page.json",dataType:"json",context:this,success:function(t){this.basketItems=t,this.refresh()}})},ExtendedBasket.prototype.createExtendBasketItems=function(t){var e=this.extendItemTemplate.clone();return e.attr("data-id",t.id),e.find(".basket-table__product-img img").attr("src",t.img),e.find(".basket-table__product-title").text(t.title),e.find(".basket-table__product-option_value")[0].innerText=t.color,e.find(".basket-table__product-option_value")[1].innerText=t.size,e.find(".basket-table__unit-price-value").text("$"+t.price),e.find(".basket-table__quantity-input").val(t.amount),e.find(".basket-table__shiping-value")[1].innerText="$"+t.amount*t.price,e},ExtendedBasket.prototype.render=function(){for(var t in this.basketItems){var e=this.basketItems[t],a=this.createExtendBasketItems(e);this.basketExtendList.append(a)}Basket.prototype.render.call(this)},ExtendedBasket.prototype.refresh=function(){this.basketExtendList.empty(),Basket.prototype.refresh.call(this)},ExtendedBasket.prototype.renderCountAndPrice=function(){Basket.prototype.renderCountAndPrice.call(this),this.tableTotalPrice.text(this.amount+".00"),this.tableSubPrice.text(this.amount+".00")},ExtendedBasket.prototype.clean=function(){this.basketItems=[],this.refresh()},ExtendedBasket.prototype.changeAmount=function(t,e){if(t=parseInt(t),(e=parseInt(e))<1)return null;var a;for(var s in this.basketItems)if(parseInt(this.basketItems[s].id)===t){a=s;break}if(void 0!==a){this.basketItems[a].amount=e;var n=this.basketItems[a].amount*this.basketItems[a].price;this.basketList=$(".cart__product-list"),this.basketExtendList=$(".basket-table__tbody");var r=this.basketList.find('.cart__product-elem[data-id="'+t+'"]');r.find(".cart__product-amount").text(this.basketItems[a].amount),r.find("span .cart__product-price").text(n),this.basketExtendList.find('tr[data-id="'+t+'"]').find(".basket-table__subtotal span").text("$"+n),this.updateCountAndPrice(),this.renderCountAndPrice()}},Good.prototype=Object.create(Container.prototype),(Good.prototype.constructor=Good).prototype.render=function(t){var e=$("<div />",{class:"good"}),a=$("<p />",{text:this.title}),s=$('<p>Цена: <span class="product-price">'+this.price+"</span> руб.</p>"),n=$("<button />",{class:"buy_good","data-id":this.id,text:"Купить"});a.appendTo(e),s.appendTo(e),n.appendTo(e),t.append(e)};